export class GenerateAnalyticsReportCommand {
  constructor(data) {
    this.reportId = data.reportId;
    this.reportType = data.reportType; // 'transaction_summary', 'user_activity', 'payment_methods', 'revenue', 'account_summary'
    this.parameters = data.parameters || {};
    this.filters = data.filters || {};
    this.generatedBy = data.generatedBy;
    this.createdAt = data.createdAt || new Date().toISOString();

    this.validate();
  }

  validate() {
    if (!this.reportId) {
      throw new Error('Report ID is required');
    }
    if (!this.reportType) {
      throw new Error('Report type is required');
    }
    if (!this.generatedBy) {
      throw new Error('Generated by is required');
    }

    const validReportTypes = [
      'transaction_summary',
      'user_activity',
      'payment_methods',
      'revenue',
      'account_summary'
    ];

    if (!validReportTypes.includes(this.reportType)) {
      throw new Error(`Invalid report type. Must be one of: ${validReportTypes.join(', ')}`);
    }
  }
}

export class UpdateAnalyticsDataCommand {
  constructor(data) {
    this.dataType = data.dataType; // 'transactions', 'accounts', 'payments', 'users'
    this.data = data.data;
    this.source = data.source; // 'event', 'batch', 'manual'
    this.updatedBy = data.updatedBy;
    this.metadata = data.metadata || {};
    this.updatedAt = data.updatedAt || new Date().toISOString();

    this.validate();
  }

  validate() {
    if (!this.dataType) {
      throw new Error('Data type is required');
    }
    if (!this.data) {
      throw new Error('Data is required');
    }
    if (!this.updatedBy) {
      throw new Error('Updated by is required');
    }

    const validDataTypes = ['transactions', 'accounts', 'payments', 'users'];
    if (!validDataTypes.includes(this.dataType)) {
      throw new Error(`Invalid data type. Must be one of: ${validDataTypes.join(', ')}`);
    }

    const validSources = ['event', 'batch', 'manual'];
    if (this.source && !validSources.includes(this.source)) {
      throw new Error(`Invalid source. Must be one of: ${validSources.join(', ')}`);
    }
  }
}

export class RefreshAnalyticsCacheCommand {
  constructor(data) {
    this.cacheType = data.cacheType; // 'all', 'transaction_summary', 'user_activity', 'payment_methods', 'revenue', 'account_summary'
    this.forceRefresh = data.forceRefresh || false;
    this.refreshedBy = data.refreshedBy;
    this.metadata = data.metadata || {};
    this.refreshedAt = data.refreshedAt || new Date().toISOString();

    this.validate();
  }

  validate() {
    if (!this.refreshedBy) {
      throw new Error('Refreshed by is required');
    }

    const validCacheTypes = [
      'all',
      'transaction_summary',
      'user_activity',
      'payment_methods',
      'revenue',
      'account_summary'
    ];

    if (this.cacheType && !validCacheTypes.includes(this.cacheType)) {
      throw new Error(`Invalid cache type. Must be one of: ${validCacheTypes.join(', ')}`);
    }
  }
}

export class ExportAnalyticsDataCommand {
  constructor(data) {
    this.exportId = data.exportId;
    this.reportType = data.reportType;
    this.format = data.format || 'json'; // 'json', 'csv', 'pdf'
    this.filters = data.filters || {};
    this.includeCharts = data.includeCharts || false;
    this.exportedBy = data.exportedBy;
    this.metadata = data.metadata || {};
    this.exportedAt = data.exportedAt || new Date().toISOString();

    this.validate();
  }

  validate() {
    if (!this.exportId) {
      throw new Error('Export ID is required');
    }
    if (!this.reportType) {
      throw new Error('Report type is required');
    }
    if (!this.exportedBy) {
      throw new Error('Exported by is required');
    }

    const validFormats = ['json', 'csv', 'pdf'];
    if (!validFormats.includes(this.format)) {
      throw new Error(`Invalid format. Must be one of: ${validFormats.join(', ')}`);
    }

    const validReportTypes = [
      'transaction_summary',
      'user_activity',
      'payment_methods',
      'revenue',
      'account_summary'
    ];

    if (!validReportTypes.includes(this.reportType)) {
      throw new Error(`Invalid report type. Must be one of: ${validReportTypes.join(', ')}`);
    }
  }
}

export class CreateAnalyticsDashboardCommand {
  constructor(data) {
    this.dashboardId = data.dashboardId;
    this.name = data.name;
    this.description = data.description;
    this.widgets = data.widgets || []; // Array of widget configurations
    this.filters = data.filters || {};
    this.refreshInterval = data.refreshInterval || 300; // seconds
    this.createdBy = data.createdBy;
    this.metadata = data.metadata || {};
    this.createdAt = data.createdAt || new Date().toISOString();

    this.validate();
  }

  validate() {
    if (!this.dashboardId) {
      throw new Error('Dashboard ID is required');
    }
    if (!this.name) {
      throw new Error('Dashboard name is required');
    }
    if (!this.createdBy) {
      throw new Error('Created by is required');
    }

    if (!Array.isArray(this.widgets)) {
      throw new Error('Widgets must be an array');
    }

    if (this.refreshInterval < 0) {
      throw new Error('Refresh interval must be non-negative');
    }
  }
}

export class UpdateAnalyticsDashboardCommand {
  constructor(data) {
    this.dashboardId = data.dashboardId;
    this.updates = data.updates || {};
    this.updatedBy = data.updatedBy;
    this.metadata = data.metadata || {};
    this.updatedAt = data.updatedAt || new Date().toISOString();

    this.validate();
  }

  validate() {
    if (!this.dashboardId) {
      throw new Error('Dashboard ID is required');
    }
    if (!this.updates || Object.keys(this.updates).length === 0) {
      throw new Error('Updates are required');
    }
    if (!this.updatedBy) {
      throw new Error('Updated by is required');
    }
  }
}